import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ValidationPipe } from '@nestjs/common';
import { ResponseInterceptor } from './utils/ParserCourserListHandler';
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';
import { NestExpressApplication } from '@nestjs/platform-express';

const key = () => {
  return `-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAu0zxYDAUwWLR2HLugxZoYipICGTTivaoa1sQdDKPWp7jrRtG
O5QmuOeXzG30+rYWQwvtNfzRDzcptru7LPjEx4ikiV+DQmAsy2PPYZcKfnsrXg25
Cm3QORUURRuaVEmrsC+sfhtB2q7kYSHJ9VTU23yIRxynudGJT24GjrAbubNlJJIv
Am00lxOIORflhVo+zBY+Ls6r5dC886y7Ow9Ias/U0CeYVgmnEcLk/0c5ntgoA6eR
4qdtbPK3bh7oOh5l7XQbSBuEo07E8hOpML62bDpPrU60u+ST4u7kNQdMvhV2bU1h
8lnTFPbso0MR17QRoLC/jlk91KnxvCRoxYnBqwIDAQABAoIBADF+ZZJLYlCv8k/G
HyzYsQCvt5UwP45LG7oyuChca/FAZ12JBYgc4BagbEaDD+doUn2pGyfXBM+Gfilh
dlat7iHkA8ahTKgvjea5G0XoicdeeNlDuw/8cLeE0HRqlN+NECdgka5JOZ+183eP
XDTOE+lkAQb5lYDO0///TRBLjSgGwTgQRL5o2Aahx3bcFMToBULCA0ERIbFqEW5Z
N75as5iXtjiY9gW0rtTeVRo2L51cpM6Bfhx+8uBV31PCWpZv59YScUfBjqZs6J8K
2iJr0qfFRDZoY4Wa+7b+ydEVN7e82ytf1skTM9sRHxVLnRJoViwoCXTkinIyTzJw
CVhlojECgYEA9rdAs3gB2d5hDHj+S7auNcHJWuCL2VfVh6leWqoYxioTecRB1IdB
PF7OKzcf9jhp7Zs0yYFng5yCCLkNq0oOHf+D59+PGq0HpccqY5zswWowbXaFWnEc
J4J+wkt8hIbcinBclZ7d8ywVZit9lV2ea0gOl4ehpa3jp+7AHGpcidcCgYEAwllP
hPY30Rse5To89y/1HdeblrenNnIERaIiDvloeyr09blV7IIkFrZtaK2V1mbt6kzr
Vo5oohJMjzn3CeXEj9xIuhKAyfz3SCUYQxrQFB2uxAiJ4OZfvr55wi8XpUko2tZQ
d4VywUbaOHhhyfcm0XlFCJXW6b0omX9aP9+clE0CgYEAqoh4nJTzEpl4E5r+i282
c8oDWGGlyRHBcwhLQ/gXL8Kdu6lAp5rmKMiPUafE2/ian7aMgkyENKDV8RmYrTF/
GJUpo/kPfazkgF5umnQ54md4GfG2s5FDmLvGyp5K74AYqUiJdpJdcFykXf7py3ju
q9Ee5PbHcTIFDmslN379f/kCgYEAtRulDrKjsSkk0VhEF9WJBhY1122tVP9LG9jL
BElHJAAT5iif+ZYNK10096dLSlEAxKaJaE+tEdsbnRzXKVIEqksNOtijS5eAmKp4
wY/q99PxWJzcX8hO0OGPdXWNA2n5uHSe58Jj/diY4qbL+flnIy1vN2DqtUag3une
oEcxEsECgYAcigHknBybO5fwo9KTzYvWTLPLDQ77+rFM7QROGVmAPGCeGu3Eu11/
Q+djf470tKK/vqdDQmmTBUiiqwm9s2YK4EX8+YzX1ZF3M6ZK0wF067D4uTieYj8l
MJVb3sx29jwSjDUMQFwuThWa8bKhzUAy3JRuYGXp1sd5044HTYgAeQ==
-----END RSA PRIVATE KEY-----`;
};
const cert = () => {
  return `-----BEGIN CERTIFICATE-----
MIIG5DCCBMygAwIBAgIQBVtKB6HgyTIIyYodEnLqZjANBgkqhkiG9w0BAQsFADBb
MQswCQYDVQQGEwJDTjElMCMGA1UEChMcVHJ1c3RBc2lhIFRlY2hub2xvZ2llcywg
SW5jLjElMCMGA1UEAxMcVHJ1c3RBc2lhIERWIFRMUyBSU0EgQ0EgMjAyNTAeFw0y
NTAzMDkwMDAwMDBaFw0yNTA2MDcyMzU5NTlaMBYxFDASBgNVBAMTC3pyemgub25s
aW5lMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAu0zxYDAUwWLR2HLu
gxZoYipICGTTivaoa1sQdDKPWp7jrRtGO5QmuOeXzG30+rYWQwvtNfzRDzcptru7
LPjEx4ikiV+DQmAsy2PPYZcKfnsrXg25Cm3QORUURRuaVEmrsC+sfhtB2q7kYSHJ
9VTU23yIRxynudGJT24GjrAbubNlJJIvAm00lxOIORflhVo+zBY+Ls6r5dC886y7
Ow9Ias/U0CeYVgmnEcLk/0c5ntgoA6eR4qdtbPK3bh7oOh5l7XQbSBuEo07E8hOp
ML62bDpPrU60u+ST4u7kNQdMvhV2bU1h8lnTFPbso0MR17QRoLC/jlk91KnxvCRo
xYnBqwIDAQABo4IC5zCCAuMwHwYDVR0jBBgwFoAUtBIopbTAHZ8pcWk82RGWSnVp
UMAwHQYDVR0OBBYEFItjccRbr+sHb83PFxfio0U9oOl7MCcGA1UdEQQgMB6CC3py
emgub25saW5lgg93d3cuenJ6aC5vbmxpbmUwPgYDVR0gBDcwNTAzBgZngQwBAgEw
KTAnBggrBgEFBQcCARYbaHR0cDovL3d3dy5kaWdpY2VydC5jb20vQ1BTMA4GA1Ud
DwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIweQYIKwYB
BQUHAQEEbTBrMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5jb20w
QwYIKwYBBQUHMAKGN2h0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9UcnVzdEFz
aWFEVlRMU1JTQUNBMjAyNS5jcnQwDAYDVR0TAQH/BAIwADCCAX4GCisGAQQB1nkC
BAIEggFuBIIBagFoAHcATnWjJ1yaEMM4W2zU3z9S6x3w4I4bjWnAsfpksWKaOd8A
AAGVeTt5nAAABAMASDBGAiEAo+LbCXLT2VfWBBpdRbsLRL0yThdv5K45lGXtGEmz
+gICIQChr4rGKnelfXKmmJ3KFcAWFPEvTxKdRw0+zzHKkIP9WQB2AHMgIg8IFor5
88SmiwqyappKAO71d4WKCE0FANSlQkRZAAABlXk7eb8AAAQDAEcwRQIhAPQaeFYs
01akYWIa9JgQmopals0TxsI/15HNKcADjE+DAiAs/5+rdpUvTHJdHMkwpydKBrTQ
GYS7zCoNJpMDJgstpgB1AH1ZHhLheCp7HGFnfF79+NCHXBSgTpWeuQMv2Q6MLnm4
AAABlXk7ec0AAAQDAEYwRAIgZ8+w1ccrILSHhJlcIb4104UA4UoNtqVjW5qmX2dh
VOwCIBTBe0uSGo8LzQ/nb6v6Nfa/kgb7uHGtnJlL/YRB2u51MA0GCSqGSIb3DQEB
CwUAA4ICAQAKmeGcdcCyS/X0OoXxqMvpE2O+TOseEXU6kza5hTiJIhaElCG4gNmK
iopo3YWCQmj9w0ptiKirPM/HXSXsa5DgjdEfNvVbh2gfmE2LltQ68I7gSiVDD69J
GLGXspKiPHOuR9rrzlhmliAQURhAApzQVK0mJOukgFQhebbJvxu9Gwl+4C8ZpHdv
WBs9QWIJzb/N0JrIrYqi5U9YWBbkC+bHYztiakBPSLDgLLIAS+tBwHQzoIdp3p7h
1lBWVUvASmSMValhIr1uEOG7FbE8H6zxjsDywUnwqigKNnb6LrfBTE1cwmvxRKoN
dv3WTX/RgvCc9nwYtwcwKJByI7qLKvLbPW382jCXLoHC6gTpLWTtDA2iOafjuMNi
fkeqDJhGnKXl1FFKdbCganTy5tTehaMoa4Xb/+KuGzc9HKxMoarIcELB73FTCti1
IqatYRogZry1NrWkpbOW9e5bh703OWuHUrrn7Giq3jtvLiLaakn5Y8vQZFtkNaDm
ncge5Apy2VDIqBbDMx2t9s0hzv8oMQoIIkEvHt5XEYAFkzR/F+tYIzV6LEtoK+FK
cK+K+BXM2SA4DnqluHYp8cHv3EqbGfSm6jQ8Pg/XGOoFtG97uKcVmc9wxPtm0Lva
PEGcbGSkJjuJViXPQBhc8sO34DaS4F86cMt0VN05dt8fPH5vusa/Tw==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFnjCCBIagAwIBAgIQCSYyO0lk42hGFRLe8aXVLDANBgkqhkiG9w0BAQsFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBH
MjAeFw0yNTAxMDgwMDAwMDBaFw0zNTAxMDcyMzU5NTlaMFsxCzAJBgNVBAYTAkNO
MSUwIwYDVQQKExxUcnVzdEFzaWEgVGVjaG5vbG9naWVzLCBJbmMuMSUwIwYDVQQD
ExxUcnVzdEFzaWEgRFYgVExTIFJTQSBDQSAyMDI1MIICIjANBgkqhkiG9w0BAQEF
AAOCAg8AMIICCgKCAgEA0fuEmuBIsN6ZZVq+gRobMorOGIilTCIfQrxNpR8FUZ9R
/GfbiekbiIKphQXEZ7N1uBnn6tXUuZ32zl6jPkZpHzN/Bmgk1BWSIzVc0npMzrWq
/hrbk5+KddXJdsNpeG1+Q8lc8uVMBrztnxaPb7Rh7yQCsMrcO4hgVaqLJWkVvEfW
ULtoCHQnNaj4IroG6VxQf1oArQ8bPbwpI02lieSahRa78FQuXdoGVeQcrkhtVjZs
ON98vq5fPWZX2LFv7e5J6P9IHbzvOl8yyQjv+2/IOwhNSkaXX3bI+//bqF9XW/p7
+gsUmHiK5YsvLjmXcvDmoDEGrXMzgX31Zl2nJ+umpRbLjwP8rxYIUsKoEwEdFoto
Aid59UEBJyw/GibwXQ5xTyKD/N6C8SFkr1+myOo4oe1UB+YgvRu6qSxIABo5kYdX
FodLP4IgoVJdeUFs1Usa6bxYEO6EgMf5lCWt9hGZszvXYZwvyZGq3ogNXM7eKyi2
20WzJXYMmi9TYFq2Fa95aZe4wki6YhDhhOO1g0sjITGVaB73G+JOCI9yJhv6+REN
D40ZpboUHE8JNgMVWbG1isAMVCXqiADgXtuC+tmJWPEH9cR6OuJLEpwOzPfgAbnn
2MRu7Tsdr8jPjTPbD0FxblX1ydW3RG30vwLF5lkTTRkHG9epMgpPMdYP7nY/08MC
AwEAAaOCAVYwggFSMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFLQSKKW0
wB2fKXFpPNkRlkp1aVDAMB8GA1UdIwQYMBaAFE4iVCAYlebjbuYP+vq5Eu0GF485
MA4GA1UdDwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIw
dgYIKwYBBQUHAQEEajBoMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2Vy
dC5jb20wQAYIKwYBBQUHMAKGNGh0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9E
aWdpQ2VydEdsb2JhbFJvb3RHMi5jcnQwQgYDVR0fBDswOTA3oDWgM4YxaHR0cDov
L2NybDMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0R2xvYmFsUm9vdEcyLmNybDARBgNV
HSAECjAIMAYGBFUdIAAwDQYJKoZIhvcNAQELBQADggEBAJ4a3svh316GY2+Z7EYx
mBIsOwjJSnyoEfzx2T699ctLLrvuzS79Mg3pPjxSLlUgyM8UzrFc5tgVU3dZ1sFQ
I4RM+ysJdvIAX/7Yx1QbooVdKhkdi9X7QN7yVkjqwM3fY3WfQkRTzhIkM7mYIQbR
r+y2Vkju61BLqh7OCRpPMiudjEpP1kEtRyGs2g0aQpEIqKBzxgitCXSayO1hoO6/
71ts801OzYlqYW9OQQQ2GCJyFbD6XHDjdpn+bWUxTKWaMY0qedSCbHE3Kl2QEF0C
ynZ7SbC03yR+gKZQDeTXrNP1kk5Qhe7jSXgw+nhbspe0q/M1ZcNCz+sPxeOwdCcC
gJE=
-----END CERTIFICATE-----`;
};
const httpsOptions = {
  key: key(),
  cert: cert(),
};

async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule, {});
  app.useStaticAssets('public', {
    maxAge: '31536000',
  });
  app.enableCors({
    origin: '*', // 允许的来源，可以是具体域名或 '*'
    methods: 'GET,POST,PUT,DELETE,OPTIONS', // 允许的 HTTP 方法
    allowedHeaders: 'Content-Type, Authorization', // 允许的请求头
    credentials: true, // 是否允许携带 Cookie
  });
  app.useGlobalPipes(new ValidationPipe());
  app.useGlobalInterceptors(new ResponseInterceptor());
  // 配置swagger
  const config = new DocumentBuilder()
    .setTitle('查课小程序接口文档')
    .setDescription('The wechat API description')
    .setVersion('1.0')
    .addBearerAuth()
    .build();
  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, document);
  await app.listen(3000);
}

bootstrap().catch((err) => console.log(err));
